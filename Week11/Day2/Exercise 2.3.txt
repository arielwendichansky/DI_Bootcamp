WITH TORAL_REV AS
	(SELECT SUM(M.REVENUE) AS TOTAL_REVENUE
		FROM MOVIES.MOVIE AS M),
	TOP_10 AS
	(SELECT M.MOVIE_ID,
			M.TITLE,
			M.REVENUE,
			NTILE(10) OVER (ORDER BY M.REVENUE DESC) AS REVENUEPERCENTILE
		FROM MOVIES.MOVIE AS M
	)
		
SELECT
	P.PERSON_NAME,
	SUM(TOP_10.REVENUE) AS TOTALREVENUE
FROM 
	TOP_10
JOIN 
	MOVIES.MOVIE_CAST AS MC ON TOP_10.MOVIE_ID = MC.MOVIE_ID
JOIN
	MOVIES.PERSON AS P ON MC.PERSON_ID = P.PERSON_ID
WHERE
	TOP_10.MOVIE_ID IN (SELECT
						MOVIE_ID
						FROM 
						TOP_10
						WHERE REVENUEPERCENTILE = 1)
GROUP BY 1;
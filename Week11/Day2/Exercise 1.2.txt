WITH MOVIE_AVG AS
	(SELECT M.MOVIE_ID,
			G.GENRE_NAME,
			M.TITLE,
			M.BUDGET,
			EXTRACT(YEAR FROM M.RELEASE_DATE) AS YEAR,
			M.VOTE_AVERAGE
		FROM MOVIES.MOVIE AS M
		JOIN MOVIES.MOVIE_GENRES AS MG ON M.MOVIE_ID = MG.MOVIE_ID
		JOIN MOVIES.GENRE AS G ON MG.GENRE_ID = G.GENRE_ID)
		
SELECT GENRE_NAME,
	TITLE,
	YEAR,
	ROUND(AVG(VOTE_AVERAGE) OVER (PARTITION BY GENRE_NAME
								  ORDER BY YEAR
								  ROWS BETWEEN 4 PRECEDING AND CURRENT ROW),2) AS MOVINGAVGRATE
FROM MOVIE_AVG
ORDER BY 1,3;